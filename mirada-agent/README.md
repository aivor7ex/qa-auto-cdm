# Mirada Agent

Python-агент для проверки отработки api в автотестах.

## ВАЖНО: Запуск с sudo

Программа требует привилегий root для работы с сетевыми интерфейсами, iptables и namespace. Все команды должны выполняться с `sudo`.

## Управление

### Полная установка и запуск
```bash
sudo ./start.sh
```
Команда `start.sh` полностью устанавливает, настраивает и запускает агент:
- Автоматически находит доступный Python (python3, python, py)
- Проверяет версию Python (требуется 3.7+)
- Удаляет старое виртуальное окружение (если есть)
- Создает новое виртуальное окружение
- Устанавливает все зависимости
- Проверяет установку модулей
- Освобождает порт от других процессов
- Запускает агент в фоновом режиме

### Полная остановка и очистка
```bash
sudo ./stop.sh
```
Команда `stop.sh` полностью останавливает и очищает всё:
- Останавливает процесс агента
- Освобождает порт
- Удаляет виртуальное окружение
- Очищает кеши pip
- Удаляет логи и временные файлы
- Очищает кеши Python

### Перезапуск
```bash
sudo ./restart.sh
```
Полный перезапуск с очисткой и переустановкой.

## API Документация

После запуска агента документация доступна по адресам:

- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc
- **OpenAPI JSON**: http://localhost:8000/openapi.json

## Требования

- Python 3.7+ (автоматически определяется)
- Привилегии root (sudo)
- Доступ к namespace `ngfw`
- Сетевые утилиты (ip, iptables, traceroute, ping)

## Особенности

- Автоматическое определение доступного Python и pip
- Поддержка различных систем (Linux, macOS, Windows WSL)
- Flask с автоматической генерацией документации OpenAPI 3.0
- Swagger UI и ReDoc для интерактивной документации
- Marshmallow схемы для валидации запросов/ответов
- Полная автоматическая установка и настройка
- Запуск в фоновом режиме с логированием
- Минимальный набор скриптов управления
- Автоматическая проверка работоспособности перед запуском
- Агрессивная очистка занятых портов
- Просмотр логов в реальном времени
- Полная очистка при остановке

## Изменение порта

```bash
MIRADA_PORT=8001 sudo ./start.sh
```

## Решение проблем

### Порт занят
```bash
# Используйте другой порт
MIRADA_PORT=8001 sudo ./start.sh

# Или остановите и запустите заново
sudo ./stop.sh
sudo ./start.sh
```

### Проблемы с правами
```bash
# Убедитесь, что запускаете с sudo
sudo ./start.sh
```

### Проблемы с зависимостями
```bash
# Полная переустановка
sudo ./stop.sh
sudo ./start.sh
```

### Python не найден
Скрипт автоматически ищет доступные версии Python в следующем порядке:
- python3, python, py
- python3.11, python3.10, python3.9, python3.8

Если Python не найден, установите Python 3.7+ и попробуйте снова. 